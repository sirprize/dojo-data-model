<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>dojo-data-model/QueryResults Test</title>
        <script type="text/javascript" src="config.js"></script>
        <script type="text/javascript" src="../vendor/dojo/dojo/dojo.js"></script>
        
        <script type="text/javascript">
            require([
                'doh',
                'dojo/Deferred',
                'dojo-data-model/DataModel',
                'dojo-data-model/QueryResults',
                'dojo/domReady!'
            ], function(
                doh,
                Deferred,
                DataModel,
                QueryResults
            ){
                var items = [{ id: 0, title: 'bla' }],
                    modelCreator = function (item) {
                        var model = new DataModel({});
                        model.deserialize(item);
                        return model;
                    }
                ;
                
                doh.register("dojo-data-model/QueryResults tests", [
                    {
                        name: 'synchronous',
                        runTest: function () {
                            var results = QueryResults(items, modelCreator);
                            doh.assertTrue(typeof results.forEach === 'function');
                            doh.assertTrue(typeof results.filter === 'function');
                            doh.assertTrue(typeof results.map === 'function');
                        }
                    },
                    {
                        name: 'asynchronous',
                        timeout: 1000,
                        runTest: function () {
                            var d = new doh.Deferred(),
                                deferred = new Deferred(),
                                results = QueryResults(deferred.promise, modelCreator)
                            ;

                            results.then(
                                function (models) {
                                    doh.assertTrue(typeof models.forEach === 'function');
                                    doh.assertTrue(typeof models.filter === 'function');
                                    doh.assertTrue(typeof models.map === 'function');
                                    d.callback(true);
                                }
                            );

                            deferred.resolve(items);
                            return d;
                        }
                    }
                ]);

                doh.run();
            });
        </script>
    </head>
    
    <body>
    </body>
</html>
